<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="text">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/logo.png">
    <!-- Page Title -->
    <title></title>
    <!-- CSS Files -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="animation.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- other Files -->
    <script src="https://unpkg.com/vue@next"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="commons.js"></script>
    <script type="text/javascript" src="user.js"></script>
    <script type="text/javascript" src="Events.js"></script>
    <script type="text/javascript" src="proxyevent.js"></script>
    <style>
        .container {
            display: flex;
            justify-content: center;
            margin-top: 10%;
            margin-bottom: 10%;
        }
        
        #errors {
            color: red;
        }
    </style>
</head>

<body id="events">
    <!-- This is the header/ Nav Bar -->
    <header id="header">
        <div class = "wrapper">
            <a href="index.html" class="logo">Mok's Farmers</a>
        </div>

        <div class ="links">
            <div class = "wrapper">
                <a href="index.html" >Home</a>
                <a href="MyGarden.html" >MyGarden</a>
            </div>
            <div class = "wrapper">
                <a href="Events.html" class="active">Events</a>
                <a href="Buy.html">Buy</a>
            </div>
        </div>

        <div class = "user-info">
        <button class="button-5" role="button">
            <div v-if="isLogged" onclick="clearSession();window.location.replace('index.html')">Logout</div>
            <div v-else><a href="login.html">Login/Signup</a></div>
        </button>
        <div id = "welcome" style ="text-align: right;" v-if="isLogged" >
            Welcome, farmer 
        </div>
        </div>
        <div style = "width:100%; display: flex;justify-content: flex-start;">
            <button onclick="window.location.replace('Events.html')" style = "font-size:1rem;width:130px;margin-bottom: 50px;" class = "button" role = "button">Back</button>
        </div>

        
    </header>

    <div class = "sec" style = "margin-top: 40px;padding-top: 25px;">
        
        <div class = "layer1 glass">

                Event details


        </div>  

        <div class = "layer 2 glass">
            <h2>Sign up now!</h2>

            <div class = "sign-up-field">
                <div>Name:</div>
                <div><input type = "text"></div>
            </div>

            <div class = "sign-up-field">
                <div>Email:</div>
                <div><input type = "text"></div>
            </div>
            
            <div class = "sign-up-field">
                <div>Phone:</div>
                <div><input type = "text"></div>
            </div>

            <div style = "width:100%;display:flex;justify-content: flex-end;"><button class = "button" role="button">Sign Up</button></div>

        </div>

        <div class = "layer3">
                
        </div>
            
    </div>

  
    
    <script>
        if (userData !=null && Object.keys(userData).length >0) {
            document.getElementById("welcome").innerHTML += userData.last_name + "!";
        }else{
            window.location.replace("index.html")
        }
        d = new Date()
        // Vue app
        const app = Vue.createApp({
                data() {
                    return {
                        cal:[],
                        months:{0:'January',1:'February',2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December"},
                        weekdays:{0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"},
                        cur_date:{
                            year: d.getFullYear(),
                            month: d.getMonth(),
                            date: d.getDate(),
                            day: d.getDay()
                        },
                        displayMonth: d.getMonth(),
                        displayYear: d.getFullYear(),
                        eventCounter:0,
                        pageCounter:0,
                        isLogged:false,
                        userEvents: {
                            registered:{'5/10/2023':{name:'Edible Gardening',location:'Toa Payoh Hub'}},
                            created:{}
                        },
                        events: [{
                            name:"EdibleGardening101 @ToaPayoh",
                            desc: "Bring your family down to Toa Payoh for a fun-filled morning learning how to grow, harvest and cook your own vegetables!",
                            date: Date("23/10/2023"),
                            startTime: "08:00",
                            endTime: "12:00",
                            location: "Toa Payoh Hub #03-23",
                            fee: "15",

                        }]
                    };
                },
                created() {
                    if (userData!=null && Object.keys(userData).length>0) {
                        this.isLogged = true;
                        
                    }
  
                    
                },
                mounted(){
                    this.populateCal()
                    console.log(this.cal)
                },
                methods: {
                    log(str){
                        console.log(str);
                        return;
                    },
                    monthPrev(){
                        
                        if (this.displayMonth == 0){
                            this.displayMonth = 11
                            this.displayYear -= 1
                        }else{
                            this.displayMonth -= 1
                        }
                        this.populateCal()
                    },
                    monthNext(){                        
                        if (this.displayMonth == 11){
                            this.displayMonth = 0
                            this.displayYear += 1
                        }else{
                            this.displayMonth += 1
                        }
                        this.populateCal()
                    },
                    populateCal(){

                        this.cal =[]
                        cur = new Date(this.displayYear,this.displayMonth,1)
                        end = new Date(this.displayYear,this.displayMonth+1)
                        cur.setDate(-cur.getDay()+1)
                        while (cur.getMonth() != end.getMonth()){
                            temp = []
                            for (let i = 0; i < 7; i++){
                                temp.push([cur.getDay(),cur.getDate(),cur.getMonth(),cur.getFullYear()])
                                cur.setDate(cur.getDate()+1)
                            }
                            this.cal.push(temp)
                        }
                        
                    },
                    onSelect(date){
                        this.cur_date.day = date[0]
                        this.cur_date.date = date[1]
                        this.cur_date.month = date[2]
                        this.cur_date.year = date[3]
                    }
                    
                },
                computed: {
                    cur_date_str(){
                        return this.cur_date.date + "/"+ this.cur_date.month + "/" + this.cur_date.year
                    }
                }
        })

        app.component('event', {
            data() {
                return {
   
                }
            },
            props: ['event'],
            template: `<div class = "event"><span>{{event.name}}, {{event.location}}</span></div>`,
            
            methods: {
                
            },
            created(){
            },
            watch:{
    
            }
        })
        app.component('date-btn', {
            data() {
                return {
                    isGrey: false,
                    d: new Date(),
                    isGreen: false,
                }
            },
            props: ['idx','row','rowNum','calLen','date','year','month','curDate','curMonth','curYear'],
            template: `<div @click= "select()" class = "date-box" v-bind:class = "{grey:isGrey,green:isGreen}"><slot></slot></div>`,
            
            methods: {
                refresh(){
                    if (this.month == this.curMonth && this.year == this.curYear && this.date == this.curDate){
                        // if(this.rowNum == 0 &&){
                            this.isGreen = true
                        // }
                    }else{
                        this.isGreen = false
                    }
                    if (this.rowNum == 0){
                        if(this.date>7){
                            this.isGrey = true
                        }else{
                            this.isGrey = false
                        }
                    }else if(this.rowNum == this.calLen-1){

                        if (this.date < 7){
                            this.isGrey = true
                        }else{
                            this.isGrey = false
                        }
                    }else{
                        this.isGrey = false
                    }
                },
                select(){
                    this.$emit('select',[this.idx,this.date,this.month,this.year])
                }
            },
            created(){
                this.refresh()
            },
            watch:{
                date(){
                    this.refresh()
                },
                curDate(){
                    this.refresh()
                }
            }
        })

        app.component('learn-btn', {
            data() {
                return {
                }
            },
            props: ['event'],
            template: `<button v-on:click="learn()" style = "font-size:1rem;width:130px" class = "button" role = "button">Learn more</button>`,
            
            methods: {
                learn(){
                    localStorage.setItem("event", JSON.stringify(this.event))
                    window.location.replace("EventDetails.html")
                }
            },
            created(){
                this.refresh()
            },
            watch:{
                date(){
                    this.refresh()
                },
                curDate(){
                    this.refresh()
                }
            }
        })

        app.mount("#events")
    </script>
</body>
</html>